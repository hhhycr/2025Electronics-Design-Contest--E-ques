# 2025Electronics-Design-Contest--E-ques
电赛   关于2025年全国大学生电子设计竞赛E题--自动打靶小车的思路分享以及代码(国二)




#硬件思路

1.首先是要进行灰度循迹，所以首先考虑的应该是灰度传感器
个人而言，灰度传感器买淘宝上面流行的就好了，感为的最好用，我只用过带mcu版本的，它可以一键自动校准，
相对于市面上的普通款式，感为的可以免去拧螺丝，怎么说呢，一分价钱一分货。

2.电机和电机驱动板来说：对于一个打智能车竞赛的~~嘻嘻，我肯定是更倾向于用我们车赛的车上面的
但是关键的就是，ti的板子没有硬件适配来读取编码器数值，所以用ti的板子只能通过采用软件中断的方式来读取线数不是那么高的编码器电机
所以，电机我推荐买一些线数不是那么高的带霍尔编码器电机就好
电机驱动板就买tb6612的绿色或者红色板子都可以，预算充足就买绿色的

3.视觉部分：我们只用了一个k230，个人感觉效果还算可以，在背景不是那么混乱的场景下识别还是非常稳定的。
当然，想要更加稳定的识别还是建议采用yolo，基础识别代码的稳定性还是差一点

4.云台部分：我们先是用的0~180°舵机二维云台，然后仔细分析题目的时候发现云台的转角是非常有必要为360°的
所以后期又紧急买了两个360°的舵机。调pid的时候也发现360°的舵机要比普通舵机好调很多
步进电机没有试过，我看到甚至还有人用无刷电机搭建云台

5.单片机的选择：小车循迹是强制要求为ti板的，建议采用mspm03507
云台控制板看自己的实验室资源，32最小系统板都够用了，我们用的是stm32f407vet6


#软件思路
！！！声明，循迹方面的代码用的是逐飞开源的mspm0库，并未使用ti官方库
逐飞库地址 ：https://gitee.com/seekfree/MSPM0G3507_Library

1.首先就是灰度循迹，由于本次的循迹要求并不是很高，所以循迹方面写的代码就比较潦草了
我是只用了一个速度环，偏差方面用的是开环方案，采用五路光电管灰度传感器，将每一路光电管给定一个拟偏差值，类似于最外面的光电管的偏差，中间的偏差为0之类的。
代码就包括  1.五个光电管的gpio初始化  2.获取偏差函数  3.速度环pid  4.一些特殊元素的处理  5.最终输出。
我的速度环在最后pwm输出时+-了1.5倍的角速度，相当于加上了一个简易的角速度环，使得调pid的工作量大大降低同时也不用专门去写一个角速度环
（加上一个完整的角度环效果会更好一点，就像我学长的循迹跑的比我好的不是一点，但是出于时间和经验问题，我并未完善循迹方面的代码）

2.然后就是云台控制以及打靶方面

(1)

我们采用视觉模块与stm32进行串口通讯，实时传输当前的镜头的中心点坐标，然后根据靶子的设定中心点坐标（由视觉模块设定）,计算出距离靶子中心点坐标的误差

(2)

按理说根据位置式pid就可以使得镜头持续跟踪靶子的中心点，但是还是出于时间和舵机的精度问题，四天三夜的时间实在不够调好一个关于舵机的位置式pid（其实也是没有这方面的经验），所以我就采用了一些小妙招,精度不够我就手动添加，死区太大我就固定给死。每当靶子瞄准到靶心附近时，也就是当坐标转换的误差角度小于一定数值时，通过定时器计时使舵机向相对应的方向转动一小段时间。所以大误差时的pid只需要粗略调整就好，只要这段距离的舵机转向调试的稍微精准一点就好。

(3)

关于打靶，同上面讲的大致思路一样，用视觉模块传输的镜头坐标与靶子的中心坐标做差，当误差值小于某一数值时，计数器就加一，否则就不变。当计数器的数值增加到一定的数值时通过gpio口输出一个高电平使继电器导通，从而激光模块开启并且打靶。

3.关于视觉模块方面的代码
这部分代码是我们队负责视觉部分的队友写的，所以我会附上相关代码，我队友的代码上面有详细的注释，大家结合k230的py库看就好。(或者直接丢给ai就好)



#赛后反思，问题总结




